---
title: 使用阿里云容器镜像服务
date: 2019-05-01 00:00:00
tags: [linux, docker, note]
categories: web开发
---

Kubernetes(k8s)搭建的时候，需要翻墙，一般像几十块这种VPN开了小飞机也是没有用的，可以使用阿里云提供的容器镜像服务，速度快，还可以不用翻墙

<!-- more -->

## 概述

阿里容器镜像服务提供了类似官方镜像管理的功能，想当初我也是死活提交不了镜像到官方仓库，国内用阿里云的会好很多。通过构建文件，定义构建规则，可以实现自动构建

1. 创建Dockerfile文件仓库，可以使用阿里的代码仓库或GitHub
2. 创建一个命名空间，最好是公有的，如果是私有的，在拉取镜像的时候需要登录，然后以这个命名空间创建镜像仓库，并和Dockerfile文件仓库绑定
3. 克隆仓库到本地，编辑Dockerfile文件，就是常规的指定镜像，由于使用阿里的机器，这里写Google的地址也可以，目的也是为了这个
4. 对本次提交打个标签，根据构建规则会自动构建，这个规则也可以自定义，查看如果构建成功就可以拉取了

注意事项：

1. 命名空间最好是公有的，私有的拉取的时候需要登录
2. 拉取镜像后，重命名成官方镜像名称，这样就相当于本地有了官方镜像，k8s运行相关服务的时候就不会再去官网拉取了
3. 流程很简单，阿里容器镜像服务都提供了详细说明
4. 由于k8s需要的镜像比较多，目前我搜集的资料来看，每一个镜像都需要执行上面的步骤，即为每一个需要的镜像去创建对应的阿里云仓库，有把相关Dockerfile整合的Git项目，可以使用这一的项目，然后自定义构建规则，设置Dockerfile文件目录（不要创建多个构建规则，然后执行不同的镜像，当前的阿里仓库只会以最后构建的镜像为准，综上所诉，一个镜像创建一个阿里仓库应该是没跑了）